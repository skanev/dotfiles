#!/usr/bin/env perl

use v5.32;
use warnings;
use utf8::all;
use experimental qw( signatures switch );
use autodie;

use lib::relative '../support/perl/lib';

use Carp qw( croak );
use Swamp::Stalker::Depot;
use Swamp::Stalker::Surveyors::RSpec;
use Swamp::Stalker::Surveyors::Rubocop;

my @surveyors = (
  Swamp::Stalker::Surveyors::RSpec::surveyor,
  Swamp::Stalker::Surveyors::Rubocop::surveyor,
);

my $depot = Swamp::Stalker::Depot->new;

if ( ! defined $ARGV[0] || $ARGV[0] eq 'stalk' ) {
  Swamp::Stalker::Consumer::devour $depot, @surveyors;
} elsif ( $ARGV[0] eq 'poke' ) {
  my $last = $depot->get( 'last' ) // {};
  my $result = $last->{result}{$ARGV[1]} // '';
  chomp $result;
  say $result;
} else {
  croak "Unknown command $ARGV[0]";
}
